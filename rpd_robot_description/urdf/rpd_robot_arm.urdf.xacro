<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">


  <!-- origin and geometry macro -->
  <xacro:macro name="origin_geometry" params="link">
    <origin rpy="0 0 0" xyz="${link['xyz']}" />
    <geometry>
      <mesh filename="file://${description_pkg}/meshes/${link['name']}.stl" />
    </geometry>
  </xacro:macro>


  <!-- Inertial macro -->
  <xacro:macro name="inertial" params="link">
    <inertial>
      <mass value="${link['mass']}" />
      <origin xyz="${link['com']}" rpy="0 0 0"/>
      <inertia ixx="${link['inertia']['ixx']}" ixy="0" ixz="0"
               iyy="${link['inertia']['iyy']}" iyz="0"
               izz="${link['inertia']['izz']}" />
    </inertial>
  </xacro:macro>


  <!-- link macro -->
  <xacro:macro name="link" params="link color:=black">
    <link name="${link['name']}">
        <visual>
        <xacro:origin_geometry link="${link}" />
        <material name="${link['color']}" />
        </visual>
        <collision>
        <xacro:origin_geometry link="${link}" />
        </collision>
        <!-- <xacro:inertial n="${links[n]}" /> -->
    </link>
  </xacro:macro>


 <!-- joint macro -->
  <xacro:macro name="joint" params="joint n">
    <joint name="${joint['name']}" type="revolute"> <!-- can keep continuous for joint_1 -->
        <origin rpy="0 0 0" xyz="${joint['xyz']}"/>
        <limit effort="${joint['effort']}" lower="${joint['lower']}" upper="${joint['upper']}" velocity="${joint['velocity']}"/>
        <axis xyz="${joint['axis']}" />
        <parent link="${links[n]['name']}" />
        <child link="${links[n+1]['name']}" />
    </joint>
  </xacro:macro>


  <!-- world link & world link to base link joint-->
  <link name="world" />
  <joint name="world_to_${links[0]['name']}" type="fixed">
    <origin rpy="0 0 0" xyz="0 0 0" />
    <parent link="world"/>
    <child link="${links[0]['name']}"/>
  </joint>


  <!-- robot links and joints -->
  <xacro:link link="${links[0]}" />
  <xacro:joint joint="${joints[0]}" n="0" />
  <xacro:link link="${links[1]}" />
  <xacro:joint joint="${joints[1]}" n="1" />
  <xacro:link link="${links[2]}" />
  <xacro:joint joint="${joints[2]}" n="2" />
  <xacro:link link="${links[3]}" />
  <xacro:joint joint="${joints[3]}" n="3" />
  <xacro:link link="${links[4]}" />

</robot>